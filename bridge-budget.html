<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Your Budget Blueprint | Unlocked</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.1.0"></script>

  <!-- IFRAME BREAKOUT + UNLOCK FLAG -->
  <script>
      (function() {
          // If loaded inside Beehiiv iframe, break out to full page
          try {
              if (window.self !== window.top) {
                  window.top.location.href = window.location.href;
                  return;
              }
          } catch(e) {}

          // Mark as unlocked (they came from Beehiiv redirect)
          localStorage.setItem('budget_unlocked', 'true');
          localStorage.setItem('budget_completed', 'true');
      })();
  </script>

  <style>
    body {
      font-family: 'Inter', sans-serif;
      background-color: #111827;
      background-image:
        radial-gradient(at 20% 80%, hsla(260, 50%, 30%, 0.2) 0px, transparent 50%),
        radial-gradient(at 80% 10%, hsla(210, 45%, 40%, 0.25) 0px, transparent 50%),
        linear-gradient(to bottom right, #111827, #131b31, #111827);
      color: #e2e8f0;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(6px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .animate-fade-in { animation: fadeIn 0.4s ease-out; }
    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #1f2937; }
    ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #6b7280; }
  </style>
</head>
<body>
  <div class="container mx-auto max-w-4xl p-4 sm:p-6 md:p-8 min-h-screen flex flex-col justify-center text-slate-300">

    <header class="text-center mb-8">
      <p class="text-sm text-slate-500 mb-1 uppercase tracking-wide">made by kou</p>
      <p class="text-xs text-slate-500 mb-3">
        Instagram: @koutalksmoney Â· YouTube: @FinanceWithKou
      </p>
      <h1 class="text-3xl sm:text-4xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-slate-100 to-slate-400">
        Budget &amp; Wealth Architect
      </h1>
      <p class="text-lg text-slate-400 mt-2">Your personalized financial blueprint.</p>
    </header>

    <main class="bg-slate-900/60 backdrop-blur-xl rounded-2xl shadow-2xl border border-white/10 overflow-hidden transition-all duration-500 relative min-h-[400px]">

      <!-- DASHBOARD (always visible, no gate) -->
      <section id="step-dashboard" class="animate-fade-in">
        <div class="bg-gradient-to-r from-amber-600/20 to-amber-900/20 border-b border-amber-500/30 p-6 text-center">
          <p class="text-amber-400 font-semibold uppercase tracking-wider text-sm mb-1">Based on your answers, we recommend</p>
          <h2 id="recommended-title" class="text-3xl font-bold text-white"></h2>
        </div>

        <div class="p-6 sm:p-8 space-y-8">
          <!-- Income Input -->
          <section class="bg-slate-800/50 p-6 rounded-xl border border-white/5">
            <label class="block text-slate-400 text-sm font-semibold mb-3">ENTER YOUR MONTHLY OR ANNUAL INCOME</label>
            <div class="flex flex-col sm:flex-row gap-4">
              <div class="relative flex-grow">
                <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">$</span>
                <input type="number" id="income-input" placeholder="e.g. 5000"
                  class="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 pl-8 text-white placeholder-slate-600 focus:outline-none focus:border-amber-500 focus:ring-1 focus:ring-amber-500 transition-all">
              </div>
              <div class="flex bg-slate-900 p-1 rounded-lg border border-slate-700">
                <button id="btn-monthly" class="px-6 py-2 rounded-md text-sm font-medium transition-all bg-amber-500 text-slate-900">Monthly</button>
                <button id="btn-annual" class="px-6 py-2 rounded-md text-sm font-medium transition-all text-slate-400">Annual</button>
              </div>
            </div>
          </section>

          <div class="flex flex-col lg:flex-row gap-8">
            
            <div class="w-full lg:w-1/2 space-y-6">
              <div>
                <h3 class="text-xl font-bold text-white mb-2">How it works</h3>
                <p id="system-desc" class="text-slate-300 leading-relaxed"></p>
              </div>
              <div>
                <h3 class="text-xl font-bold text-white mb-2">Why it fits you</h3>
                <p id="system-advantage" class="text-amber-400/90 leading-relaxed"></p>
              </div>
              <div class="h-px bg-white/10 my-6"></div>
              <div id="breakdown-list" class="space-y-3">
                <p class="text-slate-500 italic">Enter your income to see the breakdown.</p>
              </div>
            </div>

            <!-- Chart -->
            <div class="w-full lg:w-1/2 flex items-center justify-center bg-slate-800/30 rounded-xl border border-white/5 p-4 min-h-[300px]">
              <div class="relative w-full h-[300px]">
                <canvas id="budget-chart"></canvas>
              </div>
            </div>
          </div>

          <!-- System Tabs -->
          <div class="border-t border-white/10 pt-6">
            <h4 class="text-center text-slate-400 text-sm font-semibold uppercase tracking-wider mb-4">Explore Other Systems</h4>
            <div class="flex flex-wrap justify-center gap-2">
              <button class="system-tab px-4 py-2 rounded-full text-xs sm:text-sm border transition-all" data-system="50-30-20">50/30/20</button>
              <button class="system-tab px-4 py-2 rounded-full text-xs sm:text-sm border transition-all" data-system="wealth-builder">Wealth Builder</button>
              <button class="system-tab px-4 py-2 rounded-full text-xs sm:text-sm border transition-all" data-system="pay-yourself-first">Pay Yourself First</button>
              <button class="system-tab px-4 py-2 rounded-full text-xs sm:text-sm border transition-all" data-system="envelope">Envelope</button>
              <button class="system-tab px-4 py-2 rounded-full text-xs sm:text-sm border transition-all" data-system="80-20">80/20</button>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="mt-8 text-center opacity-60 text-sm text-slate-500">
      <p>Privacy First. No data is stored.</p>
    </footer>
  </div>

  <script>
    // === BUDGET SYSTEMS DATA ===
    const budgetSystems = {
      '50-30-20': {
        title: '50/30/20 Rule',
        desc: '50% for Needs, 30% for Wants, 20% for Savings & Debt Repayment.',
        advantage: 'Simplicity. Clear percentages are easy to remember without intensive tracking.',
        colors: ['#f59e0b', '#818cf8', '#60a5fa']
      },
      'wealth-builder': {
        title: 'Wealth Builder',
        desc: '50% for Needs, 25% for Investing, 15% for Wants, 10% for Savings.',
        advantage: 'Prioritizes future wealth while keeping a safety net and some fun money.',
        colors: ['#f59e0b', '#10b981', '#818cf8', '#60a5fa']
      },
      'pay-yourself-first': {
        title: 'Pay Yourself First',
        desc: 'Automatically move 20% to savings or investing as soon as income hits your account.',
        advantage: 'Automates good habits and removes the temptation to spend your savings.',
        colors: ['#60a5fa', '#818cf8']
      },
      '80-20': {
        title: '80/20 Budget',
        desc: '20% to Savings & Debt, 80% is a single flexible pool for everything else.',
        advantage: 'Maximum freedom with one simple rule: save first, then spend the rest guilt-free.',
        colors: ['#60a5fa', '#818cf8']
      },
      'envelope': {
        title: 'Envelope System',
        desc: 'Set hard limits by category (e.g., Groceries, Fun, Gas) using envelopes or digital categories.',
        advantage: 'Powerful for overspenders. Once the envelope is empty, spending stops.',
        colors: ['#f472b6', '#a78bfa', '#34d399', '#9ca3af']
      }
    };

    // === RESTORE STATE FROM LOCALSTORAGE ===
    let selectedSystem = localStorage.getItem('budget_selected_system') || '50-30-20';
    let income = parseFloat(localStorage.getItem('budget_income')) || 0;
    let incomePeriod = localStorage.getItem('budget_income_period') || 'monthly';
    let chartInstance = null;

    // === DOM ELEMENTS ===
    const recommendedTitle = document.getElementById('recommended-title');
    const systemDesc = document.getElementById('system-desc');
    const systemAdvantage = document.getElementById('system-advantage');
    const incomeInput = document.getElementById('income-input');
    const btnMonthly = document.getElementById('btn-monthly');
    const btnAnnual = document.getElementById('btn-annual');
    const breakdownList = document.getElementById('breakdown-list');
    const chartCanvas = document.getElementById('budget-chart');
    const systemTabs = document.querySelectorAll('.system-tab');

    // === FUNCTIONS ===
    function applySystemToDashboard() {
      const sys = budgetSystems[selectedSystem];
      recommendedTitle.textContent = sys.title;
      systemDesc.textContent = sys.desc;
      systemAdvantage.textContent = sys.advantage;

      systemTabs.forEach(tab => {
        const isActive = tab.dataset.system === selectedSystem;
        tab.classList.remove('bg-amber-500', 'border-amber-500', 'text-slate-900', 'border-white/10');
        tab.classList.add('border');
        if (isActive) {
          tab.classList.add('bg-amber-500', 'border-amber-500', 'text-slate-900');
        } else {
          tab.classList.add('border-white/10');
        }
      });
    }

    function getMonthlyIncome() {
      return incomePeriod === 'annual' ? income / 12 : income;
    }

    function getBreakdownForSystem() {
      const monthly = getMonthlyIncome();
      let items = [];
      if (selectedSystem === '50-30-20') {
        items = [
          { label: 'Needs', amt: monthly * 0.5, color: '#f59e0b' },
          { label: 'Wants', amt: monthly * 0.3, color: '#818cf8' },
          { label: 'Savings & Debt', amt: monthly * 0.2, color: '#60a5fa' }
        ];
      } else if (selectedSystem === 'wealth-builder') {
        items = [
          { label: 'Needs', amt: monthly * 0.5, color: '#f59e0b' },
          { label: 'Investing', amt: monthly * 0.25, color: '#10b981' },
          { label: 'Wants', amt: monthly * 0.15, color: '#818cf8' },
          { label: 'Savings', amt: monthly * 0.1, color: '#60a5fa' }
        ];
      } else if (selectedSystem === 'pay-yourself-first') {
        items = [
          { label: 'Savings', amt: monthly * 0.2, color: '#60a5fa' },
          { label: 'Everything Else', amt: monthly * 0.8, color: '#818cf8' }
        ];
      } else if (selectedSystem === '80-20') {
        items = [
          { label: 'Savings & Debt', amt: monthly * 0.2, color: '#60a5fa' },
          { label: 'Everything Else', amt: monthly * 0.8, color: '#818cf8' }
        ];
      } else {
        const d = monthly * 0.5;
        items = [
          { label: 'Groceries', amt: d * 0.3, color: '#f472b6' },
          { label: 'Fun', amt: d * 0.2, color: '#a78bfa' },
          { label: 'Shopping', amt: d * 0.15, color: '#34d399' },
          { label: 'Fixed Costs', amt: monthly - d * 0.65, color: '#9ca3af' }
        ];
      }
      return items;
    }

    function formatCurrency(amount) {
      return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(amount || 0);
    }

    function updateBreakdownAndChart() {
      const monthly = getMonthlyIncome();
      breakdownList.innerHTML = '';
      if (!income || income <= 0) {
        breakdownList.innerHTML = '<p class="text-slate-500 italic">Enter your income to see the breakdown.</p>';
      } else {
        const items = getBreakdownForSystem();
        items.forEach(item => {
          const row = document.createElement('div');
          row.className = 'flex items-center justify-between bg-slate-800/30 p-3 rounded-lg border border-white/5';
          row.innerHTML = `<div class="flex items-center gap-3">
               <div class="w-3 h-3 rounded-full" style="background-color:${item.color};"></div>
               <span class="text-slate-200 font-medium">${item.label}</span>
             </div>
             <span class="text-white font-bold">${formatCurrency(item.amt)}</span>`;
          breakdownList.appendChild(row);
        });
      }

      if (!chartCanvas) return;
      const ctx = chartCanvas.getContext('2d');
      if (!ctx) return;
      if (chartInstance) chartInstance.destroy();

      const items = getBreakdownForSystem();
      const labels = items.map(i => i.label);
      const data = items.map(i => i.amt);
      const colors = items.map(i => i.color);

      const centerTextPlugin = {
        id: 'centerText',
        afterDraw(chart) {
          const opts = chart.options.plugins.centerText || {};
          if (!opts.display) return;
          const ctx2 = chart.ctx;
          const value = opts.value || 0;
          const formatted = formatCurrency(value);
          const centerX = (chart.chartArea.left + chart.chartArea.right) / 2;
          const centerY = (chart.chartArea.top + chart.chartArea.bottom) / 2;
          ctx2.save();
          ctx2.textAlign = 'center';
          ctx2.textBaseline = 'middle';
          ctx2.font = '700 20px Inter, sans-serif';
          ctx2.fillStyle = '#f1f5f9';
          ctx2.fillText(formatted, centerX, centerY - 10);
          ctx2.font = '500 12px Inter, sans-serif';
          ctx2.fillStyle = '#94a3b8';
          ctx2.fillText('Monthly', centerX, centerY + 15);
          ctx2.restore();
        }
      };

      Chart.register(ChartDataLabels, centerTextPlugin);

      chartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels,
          datasets: [{ data, backgroundColor: colors, borderColor: '#1e293b', borderWidth: 4, hoverOffset: 10 }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '70%',
          plugins: {
            legend: { display: false },
            tooltip: { enabled: false },
            centerText: { display: true, value: monthly },
            datalabels: {
              color: '#ffffff',
              font: { weight: 'bold', size: 12 },
              formatter(value, context) {
                const label = context.chart.data.labels[context.dataIndex];
                const shortLabel = String(label).split(' ')[0];
                return shortLabel + '\n' + formatCurrency(value);
              },
              display(context) { return context.dataset.data[context.dataIndex] > 0; },
              anchor: 'end', align: 'start', offset: 10
            }
          },
          layout: { padding: 20 }
        }
      });
    }

    // === EVENT LISTENERS ===
    incomeInput.addEventListener('input', e => {
      const val = parseFloat(e.target.value);
      income = isNaN(val) ? 0 : val;
      localStorage.setItem('budget_income', income.toString());
      updateBreakdownAndChart();
    });

    btnMonthly.addEventListener('click', () => {
      incomePeriod = 'monthly';
      localStorage.setItem('budget_income_period', 'monthly');
      btnMonthly.classList.add('bg-amber-500', 'text-slate-900');
      btnAnnual.classList.remove('bg-amber-500', 'text-slate-900');
      btnAnnual.classList.add('text-slate-400');
      updateBreakdownAndChart();
    });

    btnAnnual.addEventListener('click', () => {
      incomePeriod = 'annual';
      localStorage.setItem('budget_income_period', 'annual');
      btnAnnual.classList.add('bg-amber-500', 'text-slate-900');
      btnMonthly.classList.remove('bg-amber-500', 'text-slate-900');
      btnMonthly.classList.add('text-slate-400');
      updateBreakdownAndChart();
    });

    systemTabs.forEach(tab => {
      tab.addEventListener('click', () => {
        selectedSystem = tab.dataset.system;
        localStorage.setItem('budget_selected_system', selectedSystem);
        applySystemToDashboard();
        updateBreakdownAndChart();
      });
    });

    // === INITIALIZE ===
    // Restore income input value
    if (income > 0) {
      incomeInput.value = income;
    }

    // Restore income period toggle
    if (incomePeriod === 'annual') {
      btnAnnual.classList.add('bg-amber-500', 'text-slate-900');
      btnMonthly.classList.remove('bg-amber-500', 'text-slate-900');
      btnMonthly.classList.add('text-slate-400');
    }

    // Render dashboard
    applySystemToDashboard();
    updateBreakdownAndChart();
  </script>
</body>
</html>
