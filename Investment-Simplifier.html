<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>One-Minute Portfolio Architect</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Google Fonts (Space Mono for that Matrix/Terminal vibe) -->
    <link href="https://fonts.googleapis.com/css2?family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        neon: '#00ff41',
                        darkbg: '#0d1117',
                        cardbg: '#161b22',
                        danger: '#ff3333',
                        warn: '#ffcc00',
                        ai: '#bf00ff'
                    },
                    fontFamily: {
                        mono: ['"Space Mono"', 'monospace'],
                    },
                    boxShadow: {
                        'neon': '0 0 10px #00ff41, 0 0 20px #00ff41',
                        'neon-purple': '0 0 10px #bf00ff, 0 0 20px #bf00ff',
                        'neon-red': '0 0 10px #ff3333, 0 0 20px #ff3333',
                        'neon-yellow': '0 0 10px #ffcc00, 0 0 20px #ffcc00',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #0d1117;
            color: #c9d1d9;
            font-family: 'Space Mono', monospace;
        }

        /* Custom Range Slider Styling */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            background: transparent;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 20px;
            width: 20px;
            border-radius: 50%;
            background: #00ff41;
            cursor: pointer;
            margin-top: -8px;
            box-shadow: 0 0 10px #00ff41;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%;
            height: 4px;
            cursor: pointer;
            background: #30363d;
            border-radius: 2px;
        }

        /* Animations */
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 65, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(0, 255, 65, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 65, 0); }
        }
        @keyframes pulse-yellow {
            0% { box-shadow: 0 0 0 0 rgba(255, 204, 0, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(255, 204, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 204, 0, 0); }
        }
        @keyframes pulse-purple {
            0% { box-shadow: 0 0 0 0 rgba(191, 0, 255, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(191, 0, 255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(191, 0, 255, 0); }
        }
        @keyframes typing {
            from { width: 0 }
            to { width: 100% }
        }

        .status-green {
            background-color: #00ff41;
            animation: pulse-green 2s infinite;
        }
        .status-yellow {
            background-color: #ffcc00;
            animation: pulse-yellow 2s infinite;
        }
        .ai-glow {
            animation: pulse-purple 3s infinite;
        }

        /* Modal Backdrop */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center py-10 px-4">

    <!-- HEADER -->
    <header class="text-center mb-10">
        <h1 class="text-3xl md:text-5xl font-bold text-neon mb-2 tracking-tighter">PORTFOLIO ARCHITECT</h1>
    </header>

    <!-- MAIN CONTAINER -->
    <main class="w-full max-w-5xl grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <!-- INPUTS PANEL -->
        <section class="bg-cardbg border border-gray-700 p-6 rounded-lg shadow-lg relative overflow-hidden">
            <div class="absolute top-0 left-0 w-1 h-full bg-neon"></div>
            <h2 class="text-xl text-white font-bold mb-6 border-b border-gray-700 pb-2">INPUT PARAMETERS</h2>

            <form id="portfolioForm" class="space-y-6">
                
                <!-- Age -->
                <div>
                    <label class="block text-sm text-neon mb-2">CURRENT AGE</label>
                    <input type="number" id="age" min="18" max="100" value="25" 
                           class="w-full bg-gray-900 border border-gray-600 text-white p-3 rounded focus:border-neon focus:outline-none focus:ring-1 focus:ring-neon transition">
                </div>

                <!-- Time Horizon -->
                <div>
                    <label class="block text-sm text-neon mb-2">TIME HORIZON</label>
                    <select id="horizon" class="w-full bg-gray-900 border border-gray-600 text-white p-3 rounded focus:border-neon focus:outline-none focus:ring-1 focus:ring-neon transition">
                        <option value="1">&lt; 5 Years (Short)</option>
                        <option value="2">5 - 15 Years (Medium)</option>
                        <option value="3" selected>15+ Years (Long)</option>
                    </select>
                </div>

                <!-- Risk Tolerance -->
                <div>
                    <div class="flex justify-between mb-2">
                        <label class="text-sm text-neon">RISK TOLERANCE</label>
                        <span id="riskValue" class="text-white font-bold">8</span>
                    </div>
                    <input type="range" id="risk" min="1" max="10">
                    <div class="flex justify-between text-xs text-gray-500 mt-1">
                        <span>Conservative</span>
                        <span>Aggressive</span>
                    </div>
                </div>

                <!-- Growth Flavor -->
                <div>
                    <label class="block text-sm text-neon mb-2">GROWTH FLAVOR</label>
                    <select id="growthFlavor" class="w-full bg-gray-900 border border-gray-600 text-white p-3 rounded focus:border-neon focus:outline-none focus:ring-1 focus:ring-neon transition">
                        <option value="SCHG">Broad US Growth (SCHG)</option>
                        <option value="QQQM">Top Tech / Nasdaq (QQQM)</option>
                        <option value="SMH">Semiconductors (SMH)</option>
                    </select>
                    <p class="text-xs text-gray-500 mt-2">*Only activates if Risk > 6</p>
                </div>

                <button type="button" onclick="calculatePortfolio()" 
                        class="w-full bg-neon text-black font-bold py-4 rounded mt-4 hover:bg-white hover:shadow-neon transition duration-300 uppercase tracking-widest">
                    Run Simulation
                </button>

            </form>
        </section>

        <!-- OUTPUT PANEL -->
        <section id="outputPanel" class="bg-cardbg border border-gray-700 p-6 rounded-lg shadow-lg relative hidden">
            <!-- Quality Indicator Light -->
            <div id="qualityLight" class="absolute top-6 right-6 w-4 h-4 rounded-full bg-gray-600"></div>

            <h2 class="text-xl text-white font-bold mb-6 border-b border-gray-700 pb-2">PORTFOLIO MATRIX</h2>

            <!-- Score Display -->
            <div class="flex items-center justify-between mb-6 bg-gray-900 p-4 rounded border border-gray-700">
                <div>
                    <div class="text-xs text-gray-400">QUALITY SCORE</div>
                    <div id="scoreDisplay" class="text-3xl font-bold text-white">0/10</div>
                </div>
                <div class="text-right">
                    <div class="text-xs text-gray-400">STATUS</div>
                    <div id="statusText" class="text-xl font-bold text-neon">CALCULATING...</div>
                </div>
            </div>

            <!-- Chart Container -->
            <div class="relative h-64 w-full mb-6">
                <canvas id="allocationChart"></canvas>
            </div>

            <!-- Allocation Table -->
            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm">
                    <thead>
                        <tr class="text-gray-500 border-b border-gray-700">
                            <th class="pb-2">TICKER</th>
                            <th class="pb-2">ASSET CLASS</th>
                            <th class="pb-2 text-right">ALLOCATION</th>
                        </tr>
                    </thead>
                    <tbody id="allocationList" class="text-gray-300">
                        <!-- JS renders rows here -->
                    </tbody>
                </table>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-2 gap-4 mt-6 pt-4 border-t border-gray-700">
                <div>
                    <div class="text-xs text-gray-500">AVG YIELD</div>
                    <div id="avgYield" class="text-neon font-bold">0.00%</div>
                </div>
                <div>
                    <div class="text-xs text-gray-500">EXPENSE RATIO</div>
                    <div id="avgExpense" class="text-neon font-bold">0.00%</div>
                </div>
            </div>

            <!-- AI SECTION -->
            <div class="mt-8 pt-6 border-t border-gray-700">
                <button onclick="triggerSystemAnalysis()" id="btnAnalyze" 
                    class="w-full border border-ai text-ai font-bold py-3 rounded hover:bg-ai hover:text-white transition duration-300 flex items-center justify-center gap-2">
                    <span>âœ¨</span> SYSTEM ANALYSIS (LOCAL)
                </button>

                <!-- AI Output Box -->
                <div id="aiOutputContainer" class="hidden mt-4 bg-gray-900 border border-ai p-4 rounded relative">
                    <div class="text-xs text-ai mb-2 font-bold flex justify-between">
                        <span>// ORACLE_OUTPUT</span>
                        <span id="aiLoading" class="animate-pulse hidden">COMPUTING...</span>
                    </div>
                    <p id="aiText" class="text-sm text-gray-300 leading-relaxed font-mono"></p>
                    
                    <!-- Audio Controls -->
                    <div id="audioControls" class="mt-4 pt-3 border-t border-gray-800 flex justify-end hidden">
                        <button onclick="playLocalBriefing()" class="text-xs bg-gray-800 hover:bg-ai text-white px-3 py-2 rounded flex items-center gap-2 transition">
                            <span>ðŸ”Š</span> PLAY BRIEFING
                        </button>
                    </div>
                </div>
            </div>

        </section>
    </main>

    <!-- DISCLAIMER MODAL -->
    <div id="disclaimerModal" class="fixed inset-0 modal-backdrop z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-cardbg border border-neon p-8 rounded-lg max-w-md w-full shadow-neon relative">
            <h3 class="text-2xl font-bold text-neon mb-4">SYSTEM WARNING</h3>
            <p class="text-gray-300 text-sm mb-6 leading-relaxed">
                This tool is a simulation for <strong>educational purposes only</strong>. It is not financial advice, and the "Portfolio Architect" is not a registered investment advisor. 
                <br><br>
                Investing involves risk, including loss of principal. Past performance does not guarantee future results.
            </p>
            <button onclick="acceptDisclaimer()" class="w-full bg-neon text-black font-bold py-3 rounded hover:bg-white transition uppercase">
                I Acknowledge
            </button>
        </div>
    </div>

    <script>
        // --- 1. STATIC DATA CENTER ---
        const ETF_DATA = {
            "VTI":  { name: "Total US Market",       yield: 1.35, expense: 0.03, color: "#00ff41" }, 
            "VXUS": { name: "Total Int'l Market",    yield: 2.80, expense: 0.07, color: "#008f11" }, 
            "BND":  { name: "Total Bond Market",     yield: 4.20, expense: 0.03, color: "#ffffff" }, 
            "AVUV": { name: "Small Cap Value",       yield: 1.90, expense: 0.25, color: "#ffcc00" }, 
            "SCHG": { name: "Large Cap Growth",      yield: 0.60, expense: 0.04, color: "#33ccff" }, 
            "QQQM": { name: "Nasdaq 100",            yield: 0.65, expense: 0.15, color: "#33ccff" },
            "SMH":  { name: "Semiconductors",        yield: 0.70, expense: 0.35, color: "#33ccff" }
        };

        // --- 2. GLOBAL VARIABLES ---
        let myChart = null;
        let currentPortfolio = null; // Store for Analysis
        let currentAnalysisText = ""; // Store for TTS

        // --- 3. INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            if (!sessionStorage.getItem('disclaimerAccepted')) {
                document.getElementById('disclaimerModal').classList.remove('hidden');
            }
            const riskInput = document.getElementById('risk');
            const riskValue = document.getElementById('riskValue');
            riskInput.addEventListener('input', (e) => {
                riskValue.innerText = e.target.value;
            });
        });

        function acceptDisclaimer() {
            sessionStorage.setItem('disclaimerAccepted', 'true');
            document.getElementById('disclaimerModal').classList.add('hidden');
        }

        // --- 4. CORE LOGIC ENGINE ---
        function calculatePortfolio() {
            const age = parseInt(document.getElementById('age').value);
            const horizon = parseInt(document.getElementById('horizon').value); 
            const risk = parseInt(document.getElementById('risk').value);
            const growthTicker = document.getElementById('growthFlavor').value;

            let portfolio = {}; 

            // -- Step A: Stability (BND) --
            let bndAlloc = 0;
            if (risk > 8) {
                bndAlloc = 0;
            } else if (risk < 4) {
                let ageBased = (age > 50) ? (age - 20) : 0;
                bndAlloc = Math.max(20, ageBased);
            } else {
                bndAlloc = (age > 50) ? (age - 20) : 0;
            }
            if (bndAlloc > 100) bndAlloc = 100;

            // -- Step B: Equity Block --
            let equityBlockTotal = 100 - bndAlloc;
            let currentEquityPool = equityBlockTotal;

            // -- Step C: Growth Booster --
            let growthAlloc = 0;
            if (risk > 6 && currentEquityPool > 0) {
                if (risk === 7) growthAlloc = 10;
                else if (risk === 8) growthAlloc = 15;
                else if (risk === 9) growthAlloc = 20;
                else if (risk === 10) growthAlloc = 25;
            }
            if (growthAlloc > currentEquityPool) growthAlloc = currentEquityPool;
            currentEquityPool -= growthAlloc;

            // -- Step D: Value Booster --
            let valueAlloc = 0;
            if (horizon === 3 && risk > 7 && currentEquityPool > 0) {
                valueAlloc = 10;
            }
            if (valueAlloc > currentEquityPool) valueAlloc = currentEquityPool;
            currentEquityPool -= valueAlloc;

            // -- Step E: Core Split --
            let vtiAlloc = Math.round(currentEquityPool * 0.7);
            let vxusAlloc = currentEquityPool - vtiAlloc;

            if (bndAlloc > 0) portfolio['BND'] = bndAlloc;
            if (growthAlloc > 0) portfolio[growthTicker] = growthAlloc;
            if (valueAlloc > 0) portfolio['AVUV'] = valueAlloc;
            if (vtiAlloc > 0) portfolio['VTI'] = vtiAlloc;
            if (vxusAlloc > 0) portfolio['VXUS'] = vxusAlloc;

            // Save for Analysis
            currentPortfolio = {
                age: age,
                risk: risk,
                horizon: horizon,
                allocation: portfolio,
                growthFlavor: growthTicker,
                score: 0 // Will be set in renderOutput
            };

            // Hide previous Output if any
            document.getElementById('aiOutputContainer').classList.add('hidden');
            document.getElementById('audioControls').classList.add('hidden');

            renderOutput(portfolio, risk, horizon, age, equityBlockTotal, vxusAlloc);
        }

        // --- 5. SCORING & RENDER ---
        function renderOutput(portfolio, risk, horizon, age, totalEquity, vxusPct) {
            const outputPanel = document.getElementById('outputPanel');
            const allocationList = document.getElementById('allocationList');
            const scoreDisplay = document.getElementById('scoreDisplay');
            const statusText = document.getElementById('statusText');
            const qualityLight = document.getElementById('qualityLight');
            const avgYieldEl = document.getElementById('avgYield');
            const avgExpenseEl = document.getElementById('avgExpense');

            outputPanel.classList.remove('hidden');

            let weightedYield = 0;
            let weightedExpense = 0;
            let labels = [];
            let dataPoints = [];
            let bgColors = [];

            allocationList.innerHTML = '';

            for (const [ticker, pct] of Object.entries(portfolio)) {
                if (pct <= 0) continue;
                const info = ETF_DATA[ticker];
                weightedYield += (info.yield * (pct/100));
                weightedExpense += (info.expense * (pct/100));
                labels.push(ticker);
                dataPoints.push(pct);
                bgColors.push(info.color);

                const row = `
                    <tr class="border-b border-gray-800 hover:bg-gray-800 transition">
                        <td class="py-3 font-bold text-white">${ticker}</td>
                        <td class="py-3 text-gray-400 text-xs uppercase">${info.name}</td>
                        <td class="py-3 text-right font-mono text-neon">${pct}%</td>
                    </tr>
                `;
                allocationList.innerHTML += row;
            }

            avgYieldEl.innerText = weightedYield.toFixed(2) + '%';
            avgExpenseEl.innerText = weightedExpense.toFixed(3) + '%';

            let score = 5;
            if (weightedExpense < 0.15) score += 1;
            if (portfolio['VXUS'] && portfolio['VXUS'] >= 15) score += 2;
            if (age < 30 && totalEquity >= 90) score += 3;
            if (risk > 7 && horizon === 1) score -= 2;
            if (score > 10) score = 10;
            if (score < 0) score = 0;

            // Update currentPortfolio score for analysis
            if (currentPortfolio) currentPortfolio.score = score;

            scoreDisplay.innerText = score + "/10";
            qualityLight.classList.remove('status-green', 'status-yellow');
            statusText.classList.remove('text-neon', 'text-warn');

            if (score > 7) {
                qualityLight.classList.add('status-green');
                statusText.innerText = "OPTIMIZED";
                statusText.classList.add('text-neon');
                statusText.style.color = '#00ff41';
            } else {
                qualityLight.classList.add('status-yellow');
                statusText.innerText = "CAUTION";
                statusText.classList.add('text-warn');
                statusText.style.color = '#ffcc00';
            }

            renderChart(labels, dataPoints, bgColors);
            outputPanel.scrollIntoView({ behavior: 'smooth' });
        }

        // --- 6. LOCAL SYSTEM ANALYSIS ENGINE (No API) ---

        function triggerSystemAnalysis() {
            if (!currentPortfolio) return;

            const container = document.getElementById('aiOutputContainer');
            const aiText = document.getElementById('aiText');
            const loading = document.getElementById('aiLoading');
            const btn = document.getElementById('btnAnalyze');
            const audioControls = document.getElementById('audioControls');

            container.classList.remove('hidden');
            audioControls.classList.add('hidden');
            loading.classList.remove('hidden');
            aiText.innerText = "";
            btn.disabled = true;
            btn.classList.add('opacity-50');

            // --- LOCAL LOGIC GENERATION ---
            setTimeout(() => {
                const analysis = generateLocalResponse(currentPortfolio);
                currentAnalysisText = analysis;

                loading.classList.add('hidden');
                
                // Typewriter effect
                let i = 0;
                function typeWriter() {
                    if (i < analysis.length) {
                        aiText.innerHTML += analysis.charAt(i);
                        i++;
                        setTimeout(typeWriter, 15);
                    } else {
                        audioControls.classList.remove('hidden');
                        btn.disabled = false;
                        btn.classList.remove('opacity-50');
                    }
                }
                typeWriter();
            }, 600); // Fake processing delay for "Compute" feel
        }

        function generateLocalResponse(p) {
            let outlook = "";
            let alignment = "";
            
            // Outlook based on Allocation/Risk
            if (p.risk > 7) {
                outlook = `Aggressive compounding profile. Your heavy weighting in Equities and ${p.growthFlavor || 'Growth'} positions the portfolio for maximum long-term appreciation, despite expected short-term volatility.`;
            } else if (p.risk > 4) {
                outlook = "Balanced growth profile. The strategic mix of Market Beta and Bonds provides a stable foundation, offering consistent returns while dampening market downturns.";
            } else {
                outlook = "Conservative preservation profile. High stability allocation prioritizes protecting principal and generating yield over aggressive asset expansion.";
            }

            // Alignment based on Score/Horizon
            if (p.score > 7) {
                alignment = "Excellent strategic alignment. This setup maximizes efficiency for your time horizon, effectively capturing the 'growth premium' needed for wealth acceleration.";
            } else if (p.horizon === 1 && p.risk > 6) {
                alignment = "Caution: Misaligned timeframe. High risk requires 10+ years to smooth out volatility; current horizon is too short for this growth engine.";
            } else {
                alignment = "Moderate alignment. The strategy is sound, though slightly conservative for maximizing total growth potential relative to your time horizon.";
            }

            return `OUTLOOK: ${outlook} ALIGNMENT: ${alignment}`;
        }

        // --- 7. NATIVE BROWSER TTS (No API) ---

        function playLocalBriefing() {
            if (!currentAnalysisText) return;
            
            // Stop any existing speech
            window.speechSynthesis.cancel();

            const utterance = new SpeechSynthesisUtterance(currentAnalysisText);
            
            // Try to select a "Tech" sounding voice
            const voices = window.speechSynthesis.getVoices();
            // Prefer Google US English, Microsoft David, or similar standard voices
            const preferredVoice = voices.find(v => v.name.includes("Google US English") || v.name.includes("David") || v.lang === "en-US");
            if (preferredVoice) utterance.voice = preferredVoice;

            utterance.pitch = 0.9; // Slightly lower pitch for seriousness
            utterance.rate = 1.1;  // Slightly faster

            window.speechSynthesis.speak(utterance);
        }
    </script>
</body>
</html>
